(()=>{"use strict";var e={61:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=t.IS_WINDOWS=process.platform.startsWith("win"),n=t.IS_OSX="darwin"==process.platform;t.IS_LINUX=!o&&!n,t.PIO_CORE_VERSION_SPEC=">=5.1",t.STATUS_BAR_PRIORITY_START=10,t.CONFLICTED_EXTENSION_IDS=["llvm-vs-code-extensions.vscode-clangd","vsciot-vscode.vscode-arduino","vscode-openapi"]},39:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=c();if(t&&t.has(e))return t.get(e);var o={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var r=n?Object.getOwnPropertyDescriptor(e,i):null;r&&(r.get||r.set)?Object.defineProperty(o,i,r):o[i]=e[i]}return o.default=e,t&&t.set(e,o),o}(o(425)),i=o(61),r=o(939),s=o(853),a=d(o(622)),l=d(o(549));function d(e){return e&&e.__esModule?e:{default:e}}function c(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return c=function(){return e},e}class u{constructor(){this.subscriptions=[],this._currentPanel=void 0,this._lastStartUrl=u.defaultStartUrl,this.subscriptions.push(l.default.workspace.onDidChangeWorkspaceFolders(this.disposePanel.bind(this)))}async toggle(e=u.defaultStartUrl){const t=l.default.window.activeTextEditor?l.default.window.activeTextEditor.viewColumn:void 0;try{if(this._currentPanel)return this._lastStartUrl!==e&&(this._currentPanel.webview.html=await this.getWebviewContent(e)),this._currentPanel.reveal(t)}catch(e){console.warn(e)}this._currentPanel=await this.newPanel(e)}async newPanel(e){const t=l.default.window.createWebviewPanel("pioHome",r.extension.getEnterpriseSetting("pioHomeTitle","PIO Home"),l.default.ViewColumn.One,{enableScripts:!0,retainContextWhenHidden:!0});this.subscriptions.push(t.onDidDispose(this.onPanelDisposed.bind(this))),t.iconPath=l.default.Uri.file(a.default.join(r.extension.context.extensionPath,"resources","platformio-mini-logo.svg")),t.webview.html=this.getLoadingContent();try{t.webview.html=await this.getWebviewContent(e)}catch(e){e.toString().includes("Webview is disposed")||(0,s.notifyError)("Start PIO Home Server",e)}return t}getTheme(){return((l.default.workspace.getConfiguration("workbench")||{}).colorTheme||"").toLowerCase().includes("light")?"light":"dark"}getLoadingContent(){return`<!DOCTYPE html>\n    <html lang="en">\n    <body style="background-color: ${"light"===this.getTheme()?"#FFF":"#1E1E1E"}">\n      <div style="padding: 15px;">Loading...</div>\n    </body>\n    </html>`}async getWebviewContent(e){this._lastStartUrl=e,await n.home.ensureServerStarted({port:r.extension.getSetting("pioHomeServerHttpPort"),onIDECommand:async(e,t)=>{if("open_project"===e)this.disposePanel(),l.default.workspace.workspaceFolders?l.default.workspace.updateWorkspaceFolders(l.default.workspace.workspaceFolders.length,null,{uri:l.default.Uri.file(t)}):l.default.commands.executeCommand("vscode.openFolder",l.default.Uri.file(t)),l.default.commands.executeCommand("workbench.view.explorer");else if("open_text_document"===e){const e=await l.default.window.showTextDocument(l.default.Uri.file(t.path)),o=new l.default.Position((t.line||1)-1,(t.column||1)-1);e.selection=new l.default.Selection(o,o),e.revealRange(new l.default.Range(o,o),l.default.TextEditorRevealType.InCenter)}}});const t=this.getTheme();return`<!DOCTYPE html>\n      <html lang="en">\n      <head>\n        <script>\n          window.addEventListener('message', (e) => {\n            switch (e.data.command) {\n              case 'kbd-event': {\n                if (${i.IS_OSX}) {\n                  window.dispatchEvent(new KeyboardEvent('keydown', e.data.data));\n                }\n                break;\n              }\n            }\n          }, false);\n        <\/script>\n      </head>\n      <body style="margin: 0; padding: 0; height: 100%; overflow: hidden; background-color: ${"light"===t?"#FFF":"#1E1E1E"}">\n        <iframe src="${n.home.getFrontendUrl({start:e,theme:t,workspace:r.extension.getEnterpriseSetting("defaultPIOHomeWorkspace")})}"\n          width="100%"\n          height="100%"\n          frameborder="0"\n          style="border: 0; left: 0; right: 0; bottom: 0; top: 0; position:absolute;" />\n      </body>\n      </html>\n    `}onPanelDisposed(){this._currentPanel=void 0}disposePanel(){this._currentPanel&&(this._currentPanel.dispose(),this._currentPanel=void 0)}dispose(){this.disposePanel(),n.misc.disposeSubscriptions(this.subscriptions),n.home.shutdownServer()}}t.default=u,u.defaultStartUrl="/"},405:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=d();if(t&&t.has(e))return t.get(e);var o={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var r=n?Object.getOwnPropertyDescriptor(e,i):null;r&&(r.get||r.set)?Object.defineProperty(o,i,r):o[i]=e[i]}return o.default=e,t&&t.set(e,o),o}(o(425)),i=o(61),r=l(o(327)),s=l(o(294)),a=l(o(549));function l(e){return e&&e.__esModule?e:{default:e}}function d(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return d=function(){return e},e}t.default=class{constructor(e,t=!1){this.LOCK_TIMEOUT=6e4,this.LOCK_KEY="platformio-ide:installer-lock",this.STORAGE_STATE_KEY="platformio-ide:installer-state",this.globalState=e,this.stateStorage=new s.default(e,this.STORAGE_STATE_KEY);const o=a.default.workspace.getConfiguration("platformio-ide");this.stages=[new n.installer.PlatformIOCoreStage(this.stateStorage,this.onDidStatusChange.bind(this),{pioCoreVersionSpec:i.PIO_CORE_VERSION_SPEC,useBuiltinPython:o.get("useBuiltinPython"),useBuiltinPIOCore:o.get("useBuiltinPIOCore"),useDevelopmentPIOCore:o.get("useDevelopmentPIOCore"),pythonPrompt:new r.default,disableAutoUpdates:t})]}onDidStatusChange(){this.locked()&&this.lock()}lock(){return this.globalState.update(this.LOCK_KEY,(new Date).getTime())}unlock(){return this.globalState.update(this.LOCK_KEY,void 0)}locked(){const e=this.globalState.get(this.LOCK_KEY);return!!e&&(new Date).getTime()-parseInt(e)<=this.LOCK_TIMEOUT}async check(){let e=!0;for(const t of this.stages)try{await t.check()||(e=!1)}catch(t){e=!1,console.warn(t)}return e}async install(e){const t=100/this.stages.length;for(const o of this.stages)await o.install(((o,n)=>{e.report({message:o,increment:t*(n/100)})}));e.report({message:"Finish! Please restart VSCode.",increment:100})}destroy(){return this.stages.map((e=>e.destroy()))}}},327:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0});var n=r(o(3)),i=r(o(549));function r(e){return e&&e.__esModule?e:{default:e}}t.default=class{constructor(){this.STATUS_TRY_AGAIN=0,this.STATUS_ABORT=1,this.STATUS_CUSTOMEXE=2}async prompt(){const e=await i.default.window.showInformationMessage("PlatformIO: Can not find working Python 2.7 or 3.5+ Interpreter. Please install the latest Python 3 and restart VSCode",{title:"Install Python",isCloseAffordance:!1},{title:"I have Python",isCloseAffordance:!1},{title:"Try again",isCloseAffordance:!1},{title:"Abort PlatformIO IDE Installation",isCloseAffordance:!0});switch(e?e.title:void 0){case"Install Python":return i.default.commands.executeCommand("vscode.open",i.default.Uri.parse("http://docs.platformio.org/page/faq.html#install-python-interpreter")),{status:this.STATUS_TRY_AGAIN};case"I have Python":return{status:this.STATUS_CUSTOMEXE,pythonExecutable:await i.default.window.showInputBox({prompt:"Please specify a full path to Python executable file",placeHolder:"Full path to python/python.exe",validateInput:e=>n.default.isFileSync(e)?null:"Invalid path to Python Interpreter"})};case"Abort PlatformIO IDE Installation":return{status:this.STATUS_ABORT};default:return{status:this.STATUS_TRY_AGAIN}}}}},939:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.extension=void 0,t.activate=function(e){return P.activate(e),P},t.deactivate=function(){P.deactivate(),r.deactivate()};var n=v(o(835)),i=v(o(425)),r=v(o(728)),s=v(o(853)),a=g(o(405)),l=g(o(39)),d=g(o(445)),c=g(o(673)),u=g(o(723)),p=o(61),f=g(o(294)),h=g(o(3)),m=g(o(549));function g(e){return e&&e.__esModule?e:{default:e}}function w(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return w=function(){return e},e}function v(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=w();if(t&&t.has(e))return t.get(e);var o={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var r=n?Object.getOwnPropertyDescriptor(e,i):null;r&&(r.get||r.set)?Object.defineProperty(o,i,r):o[i]=e[i]}return o.default=e,t&&t.set(e,o),o}const P=t.extension=new class{constructor(){this.context=void 0,this.pioTerm=void 0,this.pioHome=void 0,this.subscriptions=[],this._enterpriseSettings=void 0}async activate(e){this.context=e,this.stateStorage=new f.default(e.globalState),this.pioHome=new l.default,this.pioTerm=new d.default,this.subscriptions.push(this.pioHome,this.pioTerm);const t=c.default.getPIOProjectDirs().length>0;!t&&this.getSetting("activateOnlyOnPlatformIOProject")||(m.default.workspace.getConfiguration("extensions").has("showRecommendationsOnlyOnDemand")||m.default.workspace.getConfiguration("extensions").update("showRecommendationsOnlyOnDemand",!0),this.patchOSEnviron(),await this.startInstaller(!t),this.subscriptions.push(this.handleUseDevelopmentPIOCoreConfiguration()),m.default.commands.executeCommand("setContext","pioCoreReady",!0),"function"==typeof this.getEnterpriseSetting("onPIOCoreReady")&&await this.getEnterpriseSetting("onPIOCoreReady")(),this.subscriptions.push(m.default.window.registerTreeDataProvider("platformio-activitybar.quickAccess",new u.default)),this.registerGlobalCommands(),t?(m.default.commands.executeCommand("setContext","pioProjectReady",!0),this.initDebug(),this.initToolbar({ignoreCommands:this.getEnterpriseSetting("ignoreToolbarCommands")}),this.subscriptions.push(new c.default),this.startPIOHome(),n.maybeRateExtension(this.stateStorage),n.warnAboutConflictedExtensions(),this.subscriptions.push(m.default.window.onDidChangeActiveTextEditor((e=>n.warnAboutInoFile(e,this.stateStorage))))):this.initToolbar({filterCommands:["platformio-ide.showHome"]}))}getSetting(e){return m.default.workspace.getConfiguration("platformio-ide").get(e)}loadEnterpriseSettings(){const e=m.default.extensions.all.find((e=>e.id.startsWith("platformio.")&&"platformio.platformio-ide"!==e.id&&e.isActive));return e&&e.exports?e.exports.settings:void 0}getEnterpriseSetting(e,t){return this._enterpriseSettings||(this._enterpriseSettings=this.loadEnterpriseSettings()),this._enterpriseSettings&&e in this._enterpriseSettings?this._enterpriseSettings[e]:t}patchOSEnviron(){const e={PLATFORMIO_IDE:s.getIDEVersion()},t=m.default.workspace.getConfiguration("http").get("proxy");!t||process.env.HTTP_PROXY||process.env.http_proxy||(e.HTTP_PROXY=t),m.default.workspace.getConfiguration("http").get("proxyStrictSSL")||(e.CURL_CA_BUNDLE=""),!t||process.env.HTTPS_PROXY||process.env.https_proxy||(e.HTTPS_PROXY=t),this.getSetting("customPyPiIndexUrl")&&(e.PIP_INDEX_URL=this.getSetting("customPyPiIndexUrl")),i.proc.patchOSEnviron({caller:"vscode",extraPath:this.getSetting("customPATH"),extraVars:e})}async startInstaller(e){const t=new a.default(this.context.globalState,e);if(!t.locked())return await m.default.window.withProgress({location:m.default.ProgressLocation.Window,title:"PlatformIO"},(async e=>{e.report({message:"Checking PlatformIO Core installation..."});try{return!await t.check()}catch(e){}return!0}))?await m.default.window.withProgress({location:m.default.ProgressLocation.Notification,title:"PlatformIO Installer"},(async e=>{e.report({message:"Installing PlatformIO IDE..."});const o=m.default.window.createOutputChannel("PlatformIO Installation");o.show(),o.appendLine("Installing PlatformIO IDE..."),o.appendLine("It may take a few minutes depending on your connection speed"),o.appendLine("Please do not close this window and do not open other folders until this process is completed."),o.appendLine("\nDebugging information is available via VSCode > Help > Toggle Developer Tools > Console.");try{t.lock(),await t.install(e),o.appendLine("PlatformIO IDE installed successfully.\n"),o.appendLine("Please restart VSCode.");const n="Reload Now";await m.default.window.showInformationMessage("PlatformIO IDE has been successfully installed! Please reload window",n)===n&&m.default.commands.executeCommand("workbench.action.reloadWindow")}catch(e){o.appendLine("Failed to install PlatformIO IDE."),s.notifyError("Installation Manager",e)}finally{t.unlock()}return t.destroy(),!0})):void 0;m.default.window.showInformationMessage("PlatformIO IDE installation has been suspended, because PlatformIO IDE Installer is already started in another window.")}async startPIOHome(){!this.getSetting("disablePIOHomeStartup")&&i.home.showAtStartup("vscode")&&m.default.commands.executeCommand("platformio-ide.showHome")}registerGlobalCommands(){this.subscriptions.push(m.default.commands.registerCommand("platformio-ide.showHome",(e=>this.pioHome.toggle(e))),m.default.commands.registerCommand("platformio-ide.newTerminal",(()=>this.pioTerm.new().show())),m.default.commands.registerCommand("platformio-ide.openPIOCoreCLI",(()=>this.pioTerm.sendText("pio --help"))),m.default.commands.registerCommand("platformio-ide.startDebugging",(()=>{m.default.commands.executeCommand("workbench.view.debug"),m.default.commands.executeCommand("workbench.debug.action.toggleRepl"),m.default.commands.executeCommand("workbench.action.debug.start")})),m.default.commands.registerCommand("platformio-ide.updateGlobalLibs",(()=>this.pioTerm.sendText("pio lib --global update"))),m.default.commands.registerCommand("platformio-ide.updatePlatforms",(()=>this.pioTerm.sendText("pio platform update"))),m.default.commands.registerCommand("platformio-ide.updateCore",(()=>this.pioTerm.sendText("pio update"))),m.default.commands.registerCommand("platformio-ide.upgradeCore",(()=>this.pioTerm.sendText("pio upgrade"))))}initDebug(){r.activate(this.context)}initToolbar({filterCommands:e,ignoreCommands:t}){this.getSetting("disableToolbar")||[["$(home)","PlatformIO: Home","platformio-ide.showHome"],["$(check)","PlatformIO: Build","platformio-ide.build"],["$(arrow-right)","PlatformIO: Upload","platformio-ide.upload"],["$(trashcan)","PlatformIO: Clean","platformio-ide.clean"],["$(plug)","PlatformIO: Serial Monitor","platformio-ide.serialMonitor"],["$(terminal)","PlatformIO: New Terminal","platformio-ide.newTerminal"]].filter((o=>(!e||e.includes(o[2]))&&(!t||!t.includes(o[2])))).reverse().forEach(((e,t)=>{const[o,n,i]=e,r=m.default.window.createStatusBarItem(m.default.StatusBarAlignment.Left,p.STATUS_BAR_PRIORITY_START+t+1);r.text=o,r.tooltip=n,r.command=i,r.show(),this.subscriptions.push(r)}))}handleUseDevelopmentPIOCoreConfiguration(){return m.default.workspace.onDidChangeConfiguration((e=>{if(!e.affectsConfiguration("platformio-ide.useDevelopmentPIOCore")||!this.getSetting("useBuiltinPIOCore"))return;const t=i.core.getEnvDir();t&&h.default.isDirectorySync(t)&&(i.home.shutdownServer(),setTimeout((()=>{try{h.default.removeSync(t)}catch(e){console.warn(e)}m.default.window.showInformationMessage("Please restart VSCode to apply the changes.")}),2e3))}))}disposeLocalSubscriptions(){m.default.commands.executeCommand("setContext","pioCoreReady",!1),i.misc.disposeSubscriptions(this.subscriptions)}deactivate(){this.disposeLocalSubscriptions()}}},835:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.maybeRateExtension=async function(e){const t="rate-extension";let o=e.getValue(t);if(o&&o.done)return;if(o&&o.callCounter||(o={callCounter:0,done:!1}),o.callCounter+=1,o.callCounter<13)return void e.setValue(t,o);const n=await r.default.window.showInformationMessage("If you enjoy using PlatformIO IDE for VSCode, would you mind taking a moment to rate it? It will not take more than one minute. Thanks for your support!",{title:"Rate PlatformIO IDE Extension",isCloseAffordance:!1},{title:"Remind later",isCloseAffordance:!1},{title:"No, Thanks",isCloseAffordance:!0});switch(n?n.title:void 0){case"Rate PlatformIO IDE Extension":r.default.commands.executeCommand("vscode.open",r.default.Uri.parse("http://bit.ly/pio-vscode-rate")),o.done=!0;break;case"No, Thanks":o.done=!0;break;default:o.callCounter=0}e.setValue(t,o)},t.warnAboutConflictedExtensions=async function(){const e=r.default.extensions.all.filter((e=>e.isActive&&i.CONFLICTED_EXTENSION_IDS.includes(e.id)));if(0===e.length)return;const t=await r.default.window.showWarningMessage(`Conflicted extensions with IntelliSense service were detected (${e.map((e=>e.packageJSON.displayName||e.id)).join(", ")}). Code-completion, linting and navigation will not work properly. Please disable or uninstall them (Menu > View > Extensions).`,{title:"More details",isCloseAffordance:!1},{title:"Uninstall conflicted",isCloseAffordance:!1},{title:"Remind later",isCloseAffordance:!0});switch(t?t.title:void 0){case"More details":r.default.commands.executeCommand("vscode.open",r.default.Uri.parse("http://bit.ly/pio-vscode-conflicted-extensions"));break;case"Uninstall conflicted":e.forEach((e=>{r.default.commands.executeCommand("workbench.extensions.uninstallExtension",e.id)})),r.default.commands.executeCommand("workbench.action.reloadWindow")}},t.warnAboutInoFile=async function(e,t){if(!e||!e.document||!e.document.fileName)return;if(!e.document.fileName.endsWith(".ino"))return;const o="ino-warn-disabled";if(t.getValue(o))return;const n=await r.default.window.showWarningMessage("C/C++ IntelliSense service does not support .INO files. It might lead to the spurious problems with code completion, linting, and debugging. Please convert .INO sketch into the valid .CPP file.",{title:"Show instruction",isCloseAffordance:!1},{title:"Do not show again",isCloseAffordance:!1},{title:"Remind later",isCloseAffordance:!0});switch(n?n.title:void 0){case"Show instruction":r.default.commands.executeCommand("vscode.open",r.default.Uri.parse("http://bit.ly/ino2cpp"));break;case"Do not show again":t.setValue(o,1)}};var n,i=o(61),r=(n=o(549))&&n.__esModule?n:{default:n}},673:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=f();if(t&&t.has(e))return t.get(e);var o={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var r=n?Object.getOwnPropertyDescriptor(e,i):null;r&&(r.get||r.set)?Object.defineProperty(o,i,r):o[i]=e[i]}return o.default=e,t&&t.set(e,o),o}(o(425)),i=p(o(676)),r=o(61),s=p(o(294)),a=o(939),l=p(o(747)),d=o(853),c=p(o(622)),u=p(o(549));function p(e){return e&&e.__esModule?e:{default:e}}function f(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return f=function(){return e},e}class h{constructor(){this._persistentState=new s.default(a.extension.context.globalState,"projects"),this._taskManager=void 0,this._sbEnvSwitcher=void 0,this._pool=new n.project.ProjectPool({ide:"vscode",api:{createFileSystemWatcher:u.default.workspace.createFileSystemWatcher,createDirSystemWatcher:e=>u.default.workspace.createFileSystemWatcher(c.default.join(e,"*")),withIndexRebuildingProgress:e=>u.default.window.withProgress({location:{viewId:u.default.ProgressLocation.Window},title:"PlatformIO: Rebuilding IntelliSense Index"},e),withTasksLoadingProgress:e=>u.default.window.withProgress({location:{viewId:i.default.TASKS_VIEW_ID}},(async()=>await u.default.window.withProgress({location:{viewId:u.default.ProgressLocation.Window},title:"PlatformIO: Loading tasks..."},e))),onDidChangeProjectConfig:e=>{this._taskManager&&this._taskManager.projectDir===e&&this._taskManager.requestRefresh(),this.saveActiveProjectState()},onDidNotifyError:d.notifyError.bind(this)},settings:{autoPreloadEnvTasks:a.extension.getSetting("autoPreloadEnvTasks"),autoRebuild:a.extension.getSetting("autoRebuildAutocompleteIndex")}}),this.subscriptions=[this._pool,u.default.workspace.onDidChangeWorkspaceFolders((()=>this.switchToProject(this.findActiveProjectDir()))),u.default.commands.registerCommand("platformio-ide.rebuildProjectIndex",(()=>this._pool.getActiveObserver().rebuildIndex({force:!0}))),u.default.commands.registerCommand("platformio-ide.refreshProjectTasks",(()=>this._taskManager.refresh({force:!0}))),u.default.commands.registerCommand("platformio-ide.privateRunTask",(e=>this._taskManager.runTask(e)))],this.registerEnvSwitcher(),this.switchToProject(this.findActiveProjectDir())}dispose(){n.misc.disposeSubscriptions(this.subscriptions)}static isPIOProjectSync(e){try{return l.default.accessSync(c.default.join(e,"platformio.ini")),!0}catch(e){}return!1}static getPIOProjectDirs(){return(u.default.workspace.workspaceFolders||[]).map((e=>e.uri.fsPath)).filter((e=>h.isPIOProjectSync(e)))}findActiveProjectDir(){const e=h.getPIOProjectDirs(),t=this._pool.getActiveProjectDir();if(e.length<1)return;if(t&&e.find((e=>e===t)))return t;const o=this._persistentState.getValue("lastProjectDir");return o&&e.find((e=>e===o))?o:e[0]}loadProjectStateItem(e,t){return((this._persistentState.getValue("projects")||{})[e]||{})[t]}saveProjectStateItem(e,t,o){const n=this._persistentState.getValue("projects")||{};n[e]||(n[e]={}),n[e][t]=o;for(const e of Object.keys(n))h.isPIOProjectSync(e)||delete n[e];this._persistentState.setValue("projects",n),this._persistentState.setValue("lastProjectDir",e)}saveActiveProjectState(){const e=this._pool.getActiveObserver();e&&this.saveProjectStateItem(e.projectDir,"activeEnv",e.getActiveEnvName())}async switchToProject(e,t={}){if(!e)return void console.error("switchProject => Please provide project folder");this._sbEnvSwitcher.text="$(root-folder) Loading...";const o=this._pool.getObserver(e);let n;"envName"in t?n=t.envName:o.getActiveEnvName()||(n=this.loadProjectStateItem(e,"activeEnv")),await o.switchProjectEnv(n),this._pool.switch(e),this._taskManager&&(this._taskManager.dispose(),this._taskManager=void 0),this._taskManager=new i.default(e,o),0===u.default.window.visibleTextEditors.length&&u.default.window.showTextDocument(u.default.Uri.file(c.default.join(e,"platformio.ini"))),this.updateEnvSwitcher(),this.saveActiveProjectState()}registerEnvSwitcher(){this._sbEnvSwitcher=u.default.window.createStatusBarItem(u.default.StatusBarAlignment.Left,r.STATUS_BAR_PRIORITY_START),this._sbEnvSwitcher.tooltip="Switch PlatformIO Project Environment",this._sbEnvSwitcher.command="platformio-ide.switchProjectEnv",this._sbEnvSwitcher.text="$(root-folder) Loading...",this._sbEnvSwitcher.show(),this.subscriptions.push(this._sbEnvSwitcher,u.default.commands.registerCommand("platformio-ide.switchProjectEnv",(()=>this.pickProjectEnv())))}updateEnvSwitcher(){const e=this._pool.getActiveObserver();if(!e)return;const t=e.getActiveEnvName()?`env:${e.getActiveEnvName()}`:"Default";this._sbEnvSwitcher.text=`$(root-folder) ${t} (${c.default.basename(e.projectDir)})`}async pickProjectEnv(){const e=[];for(const t of h.getPIOProjectDirs()){const o=`${c.default.basename(c.default.dirname(t))}/${c.default.basename(t)}`;e.push({projectDir:t,label:"Default",description:`$(folder) ${o} ("default_envs" from "platformio.ini")`});const n=this._pool.getObserver(t);e.push(...(await n.getProjectEnvs()).map((e=>({projectDir:t,envName:e.name,label:`env:${e.name}`,description:`$(folder) ${o}`}))))}const t=await u.default.window.showQuickPick(e,{matchOnDescription:!0});t&&this.switchToProject(t.projectDir,{envName:t.envName})}}t.default=h},469:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=i();if(t&&t.has(e))return t.get(e);var o={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var s=n?Object.getOwnPropertyDescriptor(e,r):null;s&&(s.get||s.set)?Object.defineProperty(o,r,s):o[r]=e[r]}return o.default=e,t&&t.set(e,o),o}(o(549));function i(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return i=function(){return e},e}class r{constructor(e,t,o,n){this.id=e,this.envs=t,this.tasks=o,this.activeEnvName=n,this.multiEnvProject=this.envs.length>1}getTreeItem(e){return e instanceof n.TreeItem?e:this.taskToTreeItem(e)}taskToTreeItem(e){const t=new n.TreeItem(e.name);return t.iconPath=new n.ThemeIcon("circle-outline"),t.tooltip=e.title,t.command={title:e.title,command:"platformio-ide.privateRunTask",arguments:[e]},!e.coreEnv&&e.multienv&&this.multiEnvProject&&(t.label+=" All"),t}getChildren(e){return e&&e.group?this.getEnvGroupChildren(e.env,e.group):e?this.getEnvChildren(e.env):this.getRootChildren()}getRootChildren(){const e=[];for(const t of[void 0,...this.envs.map((e=>e.name))]){const o=new n.TreeItem(t||r.DEFAULT_ENV_NAME,!t||t!==this.activeEnvName&&this.multiEnvProject?n.TreeItemCollapsibleState.Collapsed:n.TreeItemCollapsibleState.Expanded);o.id=`${this.id}-${t}`,o.env=t,o.iconPath=new n.ThemeIcon("root-folder"),e.push(o)}return e}getEnvGroupChildren(e,t){return this.tasks.filter((o=>o.coreEnv===e&&o.group===t))}getEnvChildren(e){const t=this.tasks.filter((t=>t.coreEnv===e));if(!t.length)return[new n.TreeItem("Loading...")];const o=t.filter((e=>!e.group));for(const i of this.getTaskGroups(t)){const t=new n.TreeItem(i,["General","Platform"].includes(i)?n.TreeItemCollapsibleState.Expanded:n.TreeItemCollapsibleState.Collapsed);t.env=e,t.group=i,t.iconPath=n.ThemeIcon.Folder,o.push(t)}return o}getTaskGroups(e){const t=["General"],o=e.filter((e=>e.group)).map((e=>e.group));o.includes("Platform")&&t.push("Platform");for(const e of o)t.includes(e)||t.push(e);return t}}t.default=r,r.DEFAULT_ENV_NAME="Default"},676:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=d();if(t&&t.has(e))return t.get(e);var o={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var r=n?Object.getOwnPropertyDescriptor(e,i):null;r&&(r.get||r.set)?Object.defineProperty(o,i,r):o[i]=e[i]}return o.default=e,t&&t.set(e,o),o}(o(425)),i=o(61),r=l(o(469)),s=o(939),a=l(o(549));function l(e){return e&&e.__esModule?e:{default:e}}function d(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return d=function(){return e},e}class c{constructor(e,t){this.projectDir=e,this.projectObserver=t,this.subscriptions=[],this._sid=Math.random(),this._refreshTimeout=void 0,this._restoreOnDidEndTask=void 0,this._tasksToRestore=[],this.refresh()}dispose(){n.misc.disposeSubscriptions(this.subscriptions)}requestRefresh(){this._refreshTimeout&&clearTimeout(this._refreshTimeout),this._refreshTimeout=setTimeout(this.refresh.bind(this),c.AUTO_REFRESH_DELAY)}async refresh({force:e=!1}={}){this.dispose(),e&&(this.projectObserver.resetCache(),this._sid=Math.random());const t=await this.projectObserver.getProjectEnvs(),o=[...await this.projectObserver.getDefaultTasks()];for(const e of t)o.push(...await this.projectObserver.getLoadedEnvTasks(e.name)||[]);const n=a.default.window.createTreeView(c.TASKS_VIEW_ID,{treeDataProvider:new r.default(this._sid,t,o,this.projectObserver.getActiveEnvName()),showCollapseAll:!0});this.subscriptions.push(n,n.onDidExpandElement((async({element:e})=>{e.env&&await this.onDidRequestEnvTasks(e.env)})),a.default.tasks.registerTaskProvider(c.PROVIDER_TYPE,{provideTasks:async()=>o.map((e=>this.toVSCodeTask(e))),resolveTask:()=>{}}),a.default.tasks.onDidEndTaskProcess((e=>this.onDidEndTaskProcess(e)))),this.registerTaskBasedCommands(o),a.default.commands.executeCommand("setContext","pioMultiEnvProject",t.length>1)}async onDidRequestEnvTasks(e){if(!await this.projectObserver.getLoadedEnvTasks(e))return await this.projectObserver.loadEnvTasks(e),this.requestRefresh()}toVSCodeTask(e){const t=Object.create(process.env);process.env.PLATFORMIO_PATH&&(t.PATH=process.env.PLATFORMIO_PATH,t.Path=process.env.PLATFORMIO_PATH);const o=new a.default.Task({type:c.PROVIDER_TYPE,task:e.id},a.default.workspace.getWorkspaceFolder(a.default.Uri.file(this.projectDir)),e.title,c.PROVIDER_TYPE,new a.default.ProcessExecution(i.IS_WINDOWS?"platformio.exe":"platformio",e.args,{cwd:this.projectDir,env:t}),"$platformio");return o.presentationOptions={panel:a.default.TaskPanelKind.Dedicated},e.isBuild()?o.group=a.default.TaskGroup.Build:e.isClean()?o.group=a.default.TaskGroup.Clean:e.isTest()&&(o.group=a.default.TaskGroup.Test),o}runTask(e){this._restoreOnDidEndTask=void 0,this._tasksToRestore=[],this._autoCloseSerialMonitor(e),this._tasksToRestore.some((e=>this.isMonitorAndUploadTask(e)))&&this.isMonitorAndUploadTask(e)||a.default.commands.executeCommand("workbench.action.tasks.runTask",{type:c.PROVIDER_TYPE,task:e.id})}_autoCloseSerialMonitor(e){[s.extension.getSetting("autoCloseSerialMonitor"),["upload","test"].some((t=>e.args.includes(t)))].every((e=>e))&&(this._restoreOnDidEndTask=e,a.default.tasks.taskExecutions.forEach((t=>{const o=this.isMonitorAndUploadTask(t.task);[t.task.definition.type!==c.PROVIDER_TYPE,!t.task.execution.args.includes("monitor"),this.areTasksEqual(e,t.task)&&!o].some((e=>e))||((o||["device","monitor"].every((e=>t.task.execution.args.includes(e))))&&this._tasksToRestore.push(t.task),t.terminate())})))}onDidEndTaskProcess(e){[!this._restoreOnDidEndTask,e.execution.task.definition.type!==c.PROVIDER_TYPE,0!==e.exitCode&&!this.isMonitorAndUploadTask(e.execution.task),this.areTasksEqual(this._restoreOnDidEndTask,e.execution.task)].some((e=>e))||(this._restoreOnDidEndTask=void 0,setTimeout((()=>{for(;this._tasksToRestore.length;)a.default.tasks.executeTask(this._tasksToRestore.pop())}),parseInt(s.extension.getSetting("reopenSerialMonitorDelay"))))}isMonitorAndUploadTask(e){const t=e.args||e.execution.args;return["--target","upload","monitor"].every((e=>t.includes(e)))}areTasksEqual(e,t){return e&&t?(e.args||e.execution.args)===(t.args||t.execution.args):e===t}registerTaskBasedCommands(e){const t=t=>{const o=e.filter((e=>e.name===t&&e.coreEnv===this.projectObserver.getActiveEnvName()));this.runTask(o[0])};this.subscriptions.push(a.default.commands.registerCommand("platformio-ide.build",(()=>{if(s.extension.getSetting("buildTask"))return a.default.commands.executeCommand("workbench.action.tasks.runTask",s.extension.getSetting("buildTask"));t("Build")})),a.default.commands.registerCommand("platformio-ide.upload",(()=>t(s.extension.getSetting("forceUploadAndMonitor")?"Upload and Monitor":"Upload"))),a.default.commands.registerCommand("platformio-ide.test",(()=>t("Test"))),a.default.commands.registerCommand("platformio-ide.clean",(()=>t("Clean"))),a.default.commands.registerCommand("platformio-ide.serialMonitor",(()=>t("Monitor"))),a.default.commands.registerCommand("platformio-ide.remoteUpload",(()=>t("Remote Upload"))))}}t.default=c,c.PROVIDER_TYPE="PlatformIO",c.TASKS_VIEW_ID="platformio-ide.projectTasks",c.AUTO_REFRESH_DELAY=500},294:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(e,t="miscStates"){this._globalState=e,this._stateKey=t}getState(){try{return this._globalState.get(this._stateKey)||{}}catch(e){return{}}}getValue(e){return(this.getState()||{})[e]}setValue(e,t){const o=this.getState();o[e]=t,this._globalState.update(this._stateKey,o)}}},445:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0});var n,i=(n=o(549))&&n.__esModule?n:{default:n};t.default=class{constructor(){this._instance=void 0}new(){const e=Object.create(process.env);return process.env.PLATFORMIO_PATH&&(e.PATH=process.env.PLATFORMIO_PATH,e.Path=process.env.PLATFORMIO_PATH),i.default.window.createTerminal({name:"PlatformIO CLI",env:e})}sendText(e){this._instance&&void 0===this._instance.exitStatus||(this._instance=this.new()),this._instance.sendText(e),this._instance.show()}dispose(){this._instance&&this._instance.dispose(),this._instance=void 0}}},853:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.notifyError=async function(e,t){const o=t.stack||t.toString(),s=`# Description of problem\n  Leave a comment...\n\n  BEFORE SUBMITTING, PLEASE SEARCH FOR DUPLICATES IN\n  - https://github.com/platformio/platformio-vscode-ide/issues?q=is%3Aissue+\n\n  # Configuration\n\n  VSCode: ${r.default.version}\n  PIO IDE: v${d()}\n  System: ${i.default.type()}, ${i.default.release()}, ${i.default.arch()}\n\n  # Exception\n  \`\`\`\n  ${o}\n  \`\`\`\n  `,a=n.misc.getErrorReportUrl(e,s);let l="Report a problem";a.includes("issues/new")||(l="Check available solutions"),await r.default.window.showErrorMessage(o.substring(0,700)+"...",l)===l&&r.default.commands.executeCommand("vscode.open",r.default.Uri.parse(a)),console.error(t)},t.getIDEManifest=l,t.getIDEVersion=d;var n=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=a();if(t&&t.has(e))return t.get(e);var o={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var r=n?Object.getOwnPropertyDescriptor(e,i):null;r&&(r.get||r.set)?Object.defineProperty(o,i,r):o[i]=e[i]}return o.default=e,t&&t.set(e,o),o}(o(425)),i=s(o(87)),r=s(o(549));function s(e){return e&&e.__esModule?e:{default:e}}function a(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return a=function(){return e},e}function l(){return r.default.extensions.getExtension("platformio.platformio-ide").packageJSON}function d(){return l().version}},723:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=i();if(t&&t.has(e))return t.get(e);var o={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var s=n?Object.getOwnPropertyDescriptor(e,r):null;s&&(s.get||s.set)?Object.defineProperty(o,r,s):o[r]=e[r]}return o.default=e,t&&t.set(e,o),o}(o(549));function i(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return i=function(){return e},e}class r extends n.TreeItem{constructor(e,t,o,n,i){super(e,n),t&&(this.command={title:e,command:t,arguments:o}),this.customChildren=i}}t.default=class{getChildren(e){return e&&e.customChildren?e.customChildren:[new r("PIO Home",void 0,void 0,n.TreeItemCollapsibleState.Expanded,[new r("Open","platformio-ide.showHome"),new r("PIO Account","platformio-ide.showHome",["/account"]),new r("Inspect","platformio-ide.showHome",["/inspect"]),new r("Projects & Configuration","platformio-ide.showHome",["/projects"]),new r("Libraries","platformio-ide.showHome",["/libraries"]),new r("Boards","platformio-ide.showHome",["/boards"]),new r("Platforms","platformio-ide.showHome",["/platforms"]),new r("Devices","platformio-ide.showHome",["/device"])]),new r("Debug",void 0,void 0,n.TreeItemCollapsibleState.Expanded,[new r("Start Debugging","platformio-ide.startDebugging"),new r("Toggle Debug Console","workbench.debug.action.toggleRepl")]),new r("Updates",void 0,void 0,n.TreeItemCollapsibleState.Expanded,[new r("Library Updates","platformio-ide.showHome",["/libraries/updates"]),new r("Platform Updates","platformio-ide.showHome",["/platforms/updates"]),new r("Update All","platformio-ide.updateCore")]),new r("Miscellaneous",void 0,void 0,n.TreeItemCollapsibleState.Expanded,[new r("PlatformIO Core CLI","platformio-ide.openPIOCoreCLI"),new r("Clone Git Project","git.clone"),new r("New Terminal","platformio-ide.newTerminal"),new r("Upgrade PlatformIO Core","platformio-ide.upgradeCore")])]}getTreeItem(e){return e}}},747:e=>{e.exports=require("fs")},3:e=>{e.exports=require("fs-plus")},87:e=>{e.exports=require("os")},622:e=>{e.exports=require("path")},425:e=>{e.exports=require("platformio-node-helpers")},728:e=>{e.exports=require("platformio-vscode-debug")},549:e=>{e.exports=require("vscode")}},t={},o=function o(n){if(t[n])return t[n].exports;var i=t[n]={exports:{}};return e[n](i,i.exports,o),i.exports}(939);module.exports=o})();
//# sourceMappingURL=extension.js.map